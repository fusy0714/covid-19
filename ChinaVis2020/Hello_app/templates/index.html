<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新冠疫情可视分析系统</title>
    <link href="../static/styles/common.css?random=120100" rel="stylesheet">
    <script src="../static/scripts/Plugin/jquery-3.3.1.min.js"></script>
    <script src="../static/scripts/Plugin/echarts.min.js"></script>
    <script src="../static/scripts/Plugin/bmap.min.js"></script>
    <script src="../static/scripts/common.js"></script>
    <script src="../static/scripts/Plugin/laydate/laydate.js"></script>

     <!--引入中国的地图数据js文件，引入后会自动注册地图名字和数据-->
    <script src="https://www.echartsjs.com/examples/vendors/echarts/map/js/china.js?_v_=1578305236132"></script>
    <!--引入中国各个省份的地图数据js文件，引入后会自动注册地图名字和数据-->
    <script src="../static/scripts/maps/hebei.js"></script><!-- 河北 -->
    <script src="../static/scripts/maps/shanxi.js"></script><!-- 山西 -->
    <script src="../static/scripts/maps/liaoning.js"></script><!-- 辽宁 -->
    <script src="../static/scripts/maps/jilin.js"></script><!-- 吉林 -->
    <script src="../static/scripts/maps/heilongjiang.js"></script><!-- 黑龙江 -->
    <script src="../static/scripts/maps/jiangsu.js"></script><!-- 江苏 -->
    <script src="../static/scripts/maps/zhejiang.js"></script><!-- 浙江 -->
    <script src="../static/scripts/maps/anhui.js"></script><!-- 安徽 -->
    <script src="../static/scripts/maps/fujian.js"></script><!-- 福建 -->
    <script src="../static/scripts/maps/jiangxi.js"></script><!-- 江西 -->
    <script src="../static/scripts/maps/shandong.js"></script><!-- 山东 -->
    <script src="../static/scripts/maps/henan.js"></script><!-- 河南 -->
    <script src="../static/scripts/maps/hubei.js"></script><!-- 湖北 -->
    <script src="../static/scripts/maps/hunan.js"></script><!-- 湖南 -->
    <script src="../static/scripts/maps/guangdong.js"></script><!-- 广东 -->
    <script src="../static/scripts/maps/hainan.js"></script><!-- 海南 -->
    <script src="../static/scripts/maps/sichuan.js"></script><!-- 四川 -->
    <script src="../static/scripts/maps/guizhou.js"></script><!-- 贵州 -->
    <script src="../static/scripts/maps/yunnan.js"></script><!-- 云南 -->
    <script src="../static/scripts/maps/shanxi1.js"></script><!-- 陕西 -->
    <script src="../static/scripts/maps/gansu.js"></script><!-- 甘肃 -->
    <script src="../static/scripts/maps/qinghai.js"></script><!-- 青海 -->
    <script src="../static/scripts/maps/taiwan.js"></script><!-- 台湾 -->
    <script src="../static/scripts/maps/neimenggu.js"></script><!-- 内蒙古 -->
    <script src="../static/scripts/maps/guangxi.js"></script><!-- 广西 -->
    <script src="../static/scripts/maps/xizang.js"></script><!-- 西藏 -->
    <script src="../static/scripts/maps/ningxia.js"></script><!-- 宁夏 -->
    <script src="../static/scripts/maps/xinjiang.js"></script><!-- 新疆 -->
    <script src="../static/scripts/maps/beijing.js"></script><!-- 北京 -->
    <script src="../static/scripts/maps/shanghai.js"></script><!-- 上海 -->
    <script src="../static/scripts/maps/tianjin.js"></script><!-- 天津 -->
    <script src="../static/scripts/maps/chongqing.js"></script><!-- 重庆 -->
    <script src="../static/scripts/maps/xianggang.js"></script><!-- 香港 -->
    <script src="../static/scripts/maps/aomen.js"></script><!-- 澳门 -->
</head>
<body>
<!--顶部-->
<header class="header left">
    <div class="left nav">
        <ul>
            <li class="nav_active"><a href="{% url 'home' %}">主界面</a> </li>
            <li><a href="{% url 'timezone' %}">时空态势</a> </li>
            <li><a href="{% url 'qianyi' %}">迁徙传播</a> </li>
            <li><a href="{% url 'yuqing' %}">舆情分析</a> </li>
            </ul>
    </div>
    <div class="header_center left" style="position:relative">
        <h2><strong>新冠疫情可视分析系统</strong></h2>
    </div>

</header>
<!--内容部分-->
<div class="con left">
    <!--统计分析图-->
    <div class="div_any">
        <div class="left div_any02" style="width: 48%">
            <div class="div_any_child ">
                <div class="div_any_title"><img src="../static/images/title_0.png">疫情地图</div>
                <div id="mapChart_home" class="p_chart"></div>
            </div>
            <div class="div_any_child">
                <!--                <div class="div_any_title"><img src="../images/title_12.png">疫情控制情况</div>-->
                <div class="div_any_title"><img src="../static/images/title_0.png">传播地图</div>
{#                <p id="pieChart2" class="p_chart"></p>#}
            </div>
        </div>
        <div class="right div_any02" style="width: 48%">
            <div class="div_any_child">
                <div class="div_any_title"><img src="../static/images/title_11.png">具体省份地图</div>
                <p id="pieChart1" class="p_chart"></p>
            </div>
            <div class="div_any_child">
                <div class="div_any_title"><img src="../static/images/title_5.png">省份动态折线图</div>
                <p id="histogramChart1" class="p_chart"></p>
            </div>
        </div>
    </div>
</div>
</body>

<script>
    var myColor = ['#1089E7', '#F57474', '#56D0E3', '#F8B448', '#8B78F6'];
    // 国家地图
    let myChart = echarts.init(document.getElementById('mapChart_home'),'dark');
    // 指定图表的配置项和数据
    option = {
        tooltip: {  // 配置提示信息
            trigger: 'item'
        },
        backgroundColor: '#081832',
        legend: {  // 图例组件展现了不同系列的标记(symbol)，颜色和名字。可以通过点击图例控制哪些系列不显示
            orient: 'vertical',
            left: 'left',
            data: ['中国疫情图']
        },
        visualMap: {
            type: 'piecewise',
            pieces: [
                { min: 1000, max: 1000000, label: '大于等于1000人', color: '#372a28' },
                { min: 500, max: 999, label: '确诊500-999人', color: '#4e160f' },
                { min: 100, max: 499, label: '确诊100-499人', color: '#974236' },
                { min: 10, max: 99, label: '确诊10-99人', color: '#ee7263' },
                { min: 1, max: 9, label: '确诊1-9人', color: '#f5bba7' },
            ],
            color: ['#E0022B', '#E09107', '#A3E00B']
        },
        toolbox: {
            show: true,
            orient: 'vertical',
            left: 'right',
            top: 'center',
            feature: {
                mark: { show: true },
                dataView: { show: true, readOnly: false },
                restore: { show: true },
                saveAsImage: { show: true }
            }
        },
        roamController: {
            show: true,
            left: 'right',
            mapTypeControl: {
                'china': true
            }
        },
        series: [  // 每个系列通过 type 决定自己的图表类型
            {
                name: '确诊数',
                type: 'map',
                mapType: 'china',
                roam: false,
                label: {
                    show: true,
                    color: 'rgb(249, 249, 249)'
                },
                data: []
            }
        ]
    };

    //使用指定的配置项和数据显示图表
    myChart.setOption(option);

    //获取数据
        function getData() {
            $.ajax({
                url: "https://view.inews.qq.com/g2/getOnsInfo?name=disease_h5",
                dataType: "jsonp",
                success: function (data) {
                    //  console.log(data.data)
                    var res = data.data || "";
                    res = JSON.parse(res);
                    var newArr = [];
                    //newArr的数据格式为：
                    // [{
                    //   name: '北京11',
                    //   value: 212
                    // }, {
                    //   name: '天津',
                    //   value: 60
                    // }]
                    if (res) {
                        //获取到各个省份的数据
                        var province = res.areaTree[0].children;
                        for (var i = 0; i < province.length; i++) {
                            var json = {
                                name: province[i].name,
                                value: province[i].total.confirm
                            };
                            newArr.push(json)
                        }
                        console.log(newArr);
                        console.log(JSON.stringify(newArr));
                        //使用指定的配置项和数据显示图表
                        myChart.setOption({
                            series: [
                                {
                                    name: '确诊数',
                                    type: 'map',
                                    mapType: 'china',
                                    roam: false,
                                    zoom:1,
                                    label: {
                                        show: true,
                                        color: 'rgb(249, 249, 249)'
                                    },
                                    data: newArr
                                }
                            ]
                        });
                    }
                }

            })
        }
        getData();


</script>
</html>
